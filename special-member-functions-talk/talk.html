<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Kris van Rens">
  <title>Special member functions in  </title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reset.css">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/solarized.css" id="theme">
  <link rel="stylesheet" href="css/pandoc-overrides.css"/>
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Special member functions in <br/><img src='images/cpp-logo.png' width='15%' style='margin-top:2%;margin-bottom:-2%'/></h1>
  <p class="author">Kris van Rens</p>
</section>

<section>
<section id="whats-ahead" class="title-slide slide level1">
<h1>What’s ahead?</h1>
<ul>
<li class="fragment"><strong>Special member function <span style="color:crimson"><strong>fundamentals</strong></span></strong></li>
<li class="fragment"><strong><span style="color:crimson"><strong>Declaration rules</strong></span></strong></li>
<li class="fragment"><strong>Implementation <span style="color:crimson"><strong>guidelines</strong></span></strong></li>
<li class="fragment"><strong>Tooling and <span style="color:crimson"><strong>best practices</strong></span></strong></li>
<li class="fragment"><strong>Conclusions</strong></li>
</ul>
</section>
<section id="a-little-bit-about-me" class="slide level2">
<h2>A little bit about me</h2>
<p><img data-src="images/em-nerd_face.svg" style="width:7.0%" /> <img data-src="images/em-man-woman-girl-boy.svg" style="width:7.0%" /> <img data-src="images/em-guitar.svg" style="width:7.0%" /> <img data-src="images/em-running.svg" style="width:7.0%" /> <img data-src="images/em-man_climbing.svg" style="width:7.0%" /></p>
<p><a href="">kris@vanrens.org</a></p>
</section>
<section id="the-premise-and-goals" class="slide level2">
<h2>The premise and goals</h2>
<div class="fragment">
<table style="width:62%;">
<colgroup>
<col style="width: 12%" />
<col style="width: 6%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="odd">
<td>SMF</td>
<td>==</td>
<td>Special member function</td>
</tr>
<tr class="even">
<td>c’tor</td>
<td>==</td>
<td>Constructor</td>
</tr>
<tr class="odd">
<td>d’tor</td>
<td>==</td>
<td>Destructor</td>
</tr>
</tbody>
</table>
</div>
<div class="fragment">
<p><img data-src="images/cpp-classic.png" style="width:10.0%" /> <img data-src="images/cpp-modern.png" style="width:10.0%" /></p>
</div>
</section></section>
<section>
<section id="special-member-function-fundamentals" class="title-slide slide level1">
<h1>Special member function <span style="color:crimson"><strong>fundamentals</strong></span></h1>

</section>
<section id="define-special.." class="slide level2">
<h2>Define ‘special’..</h2>
<blockquote>
<p>Some member functions are <strong>special</strong>: under certain circumstances they are defined by the compiler even if not defined by the user.</p>
</blockquote>
<p><em><a href="https://en.cppreference.com/w/cpp/language/member_functions">cppreference.com</a> § Non-static member functions</em></p>
</section>
<section id="then-what-is-define" class="slide level2">
<h2>Then what is ‘define’?</h2>
<div class="fragment">
<p>Let’s first look at ‘declare’:</p>
<blockquote>
<p>Declarations introduce (or re-introduce) names into the C++ program. Each kind of entity is declared differently.</p>
</blockquote>
<p><a href="https://en.cppreference.com/w/cpp/language/declarations">cppreference.com</a> § Declarations</p>
</div>
</section>
<section id="the-definition-of-a-definition" class="slide level2">
<h2>The definition of a definition</h2>
<blockquote>
<p>Definitions are declarations that fully define the entity introduced by the declaration.</p>
</blockquote>
<p><a href="https://en.cppreference.com/w/cpp/language/definition">cppreference.com</a> § Definitions and ODR</p>
</section>
<section id="section" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column">
<p><strong>Declarations</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1"></a><span class="dt">int</span> i;</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="dt">float</span> array[<span class="dv">2</span>];</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">auto</span>&amp; [x, y] = array;</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="dt">void</span> func();</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">using</span> Func = <span class="bu">std::</span>function&lt;<span class="dt">void</span>()&gt;;</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="kw">enum</span> <span class="kw">class</span> E;</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt;</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw">struct</span> Y;</span></code></pre></div>
</div><div class="column">
<p><strong>Definitions</strong>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1"></a><span class="dt">int</span> i = <span class="dv">42</span>;</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="dt">float</span> array[<span class="dv">2</span>] = {};</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="dt">void</span> func() { <span class="co">/* ... */</span>  }</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="kw">enum</span> <span class="kw">class</span> E { Zero, One };</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt; <span class="co">// A.K.A. &#39;temploid&#39;.</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="kw">struct</span> Y {</span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="kw">auto</span> size() {</span>
<span id="cb2-12"><a href="#cb2-12"></a>    <span class="kw">sizeof</span>(T);</span>
<span id="cb2-13"><a href="#cb2-13"></a>  }</span>
<span id="cb2-14"><a href="#cb2-14"></a>};</span></code></pre></div>
</div>
</div>
</section>
<section id="magic" class="slide level2">
<h2>Magic! <img data-src="images/cpp-classic.png" style="width:8.0%" /></h2>
<div class="columns">
<div class="column" style="width:28%;">
<p>Original code:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">class</span> X {};</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="dt">int</span> main() {</span>
<span id="cb3-4"><a href="#cb3-4"></a>  X x1;</span>
<span id="cb3-5"><a href="#cb3-5"></a>  X x2(x1);</span>
<span id="cb3-6"><a href="#cb3-6"></a>  x2 = x1;</span>
<span id="cb3-7"><a href="#cb3-7"></a>}</span></code></pre></div>
</div><div class="column" style="width:72%;">
<p>What the compiler <img data-src="images/em-mage.svg" style="width:5.0%" /> will define for <code class="sourceCode cpp">X</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">class</span> X {</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw">public</span>: </span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="kw">inline</span> X() = <span class="cf">default</span>;</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="co">// inline ~X() = default;</span></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="kw">inline</span> X(<span class="at">const</span> X&amp;) = <span class="cf">default</span>;</span>
<span id="cb4-7"><a href="#cb4-7"></a>  <span class="kw">inline</span> X&amp; <span class="kw">operator</span>=(<span class="at">const</span> X&amp;) = <span class="cf">default</span>;</span>
<span id="cb4-8"><a href="#cb4-8"></a>};</span></code></pre></div>
</div>
</div>
</section>
<section id="magic-1" class="slide level2">
<h2>Magic! <img data-src="images/cpp-modern.png" style="width:6.0%" /></h2>
<div class="columns">
<div class="column" style="width:28%;">
<p>Original code:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">class</span> X {};</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="dt">int</span> main() {</span>
<span id="cb5-4"><a href="#cb5-4"></a>  X x1;</span>
<span id="cb5-5"><a href="#cb5-5"></a>  X x2(x1);</span>
<span id="cb5-6"><a href="#cb5-6"></a>  x2 = x1;</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>  X x3{<span class="bu">std::</span>move(x1)};</span>
<span id="cb5-9"><a href="#cb5-9"></a>  x4 = <span class="bu">std::</span>move(x2);</span>
<span id="cb5-10"><a href="#cb5-10"></a>}</span></code></pre></div>
</div><div class="column" style="width:72%;">
<p>What the compiler <img data-src="images/em-mage.svg" style="width:5.0%" /> will define for <code class="sourceCode cpp">X</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">class</span> X {</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">public</span>: </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="kw">inline</span> <span class="kw">constexpr</span> X() <span class="kw">noexcept</span> = <span class="cf">default</span>;</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="co">// inline ~X() noexcept = default;</span></span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="kw">inline</span> <span class="kw">constexpr</span> X(<span class="at">const</span> X&amp;) <span class="kw">noexcept</span> = <span class="cf">default</span>;</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="kw">inline</span> <span class="kw">constexpr</span> X&amp; <span class="kw">operator</span>=(<span class="at">const</span> X&amp;) <span class="kw">noexcept</span> = <span class="cf">default</span>;</span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="kw">inline</span> <span class="kw">constexpr</span> X(X&amp;&amp;) <span class="kw">noexcept</span> = <span class="cf">default</span>;</span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="kw">inline</span> <span class="kw">constexpr</span> X&amp; <span class="kw">operator</span>=(X&amp;&amp;) <span class="kw">noexcept</span> = <span class="cf">default</span>;</span>
<span id="cb6-11"><a href="#cb6-11"></a>};</span></code></pre></div>
</div>
</div>
</section>
<section id="when-the-magic-is-gone" class="slide level2">
<h2>When the magic is gone</h2>
<h4 id="well-partly-so..">Well, partly so..</h4>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">struct</span> X {</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="at">const</span> <span class="dt">int</span> <span class="va">value_</span>;</span>
<span id="cb7-3"><a href="#cb7-3"></a>};</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="dt">int</span> main() {</span>
<span id="cb7-6"><a href="#cb7-6"></a>  X x; <span class="co">// Compiler error!</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>}</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">struct</span> Y {</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="dt">uint8_t</span> &amp;<span class="va">data_</span>;</span>
<span id="cb8-3"><a href="#cb8-3"></a>};</span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="dt">int</span> main() {</span>
<span id="cb8-6"><a href="#cb8-6"></a>  Y y; <span class="co">// Compiler error!</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>}</span></code></pre></div>
</div>
</div>
<div class="fragment">
<p>Examples are ill-formed, and the default constructors are deleted</p>
</div>
</section>
<section id="having-the-magic-return" class="slide level2">
<h2>Having the magic return</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">struct</span> X {</span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="kw">explicit</span> X(<span class="dt">int</span> arg)</span>
<span id="cb9-3"><a href="#cb9-3"></a>    : <span class="va">value_</span>{arg} {</span>
<span id="cb9-4"><a href="#cb9-4"></a>  }</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="at">const</span> <span class="dt">int</span> <span class="va">value_</span>;</span>
<span id="cb9-7"><a href="#cb9-7"></a>};</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="dt">int</span> main() {</span>
<span id="cb9-10"><a href="#cb9-10"></a>  X x1{<span class="dv">42</span>};</span>
<span id="cb9-11"><a href="#cb9-11"></a>  X x2{x1};</span>
<span id="cb9-12"><a href="#cb9-12"></a>  X x3{<span class="bu">std::</span>move(x2)};</span>
<span id="cb9-13"><a href="#cb9-13"></a>  <span class="co">// Any assignment is impossible..</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>}</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">struct</span> Y {</span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="kw">explicit</span> Y(<span class="dt">uint8_t</span>&amp; data)</span>
<span id="cb10-3"><a href="#cb10-3"></a>    : <span class="va">data_</span>{data} {</span>
<span id="cb10-4"><a href="#cb10-4"></a>  }</span>
<span id="cb10-5"><a href="#cb10-5"></a></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="dt">uint8_t</span> &amp;<span class="va">data_</span>;</span>
<span id="cb10-7"><a href="#cb10-7"></a>};</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="dt">int</span> main() {</span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="dt">uint8_t</span> data[<span class="dv">8</span>];</span>
<span id="cb10-11"><a href="#cb10-11"></a></span>
<span id="cb10-12"><a href="#cb10-12"></a>  Y y1{data[<span class="dv">0</span>]};</span>
<span id="cb10-13"><a href="#cb10-13"></a>  Y y2{y1};</span>
<span id="cb10-14"><a href="#cb10-14"></a>  Y y3{<span class="bu">std::</span>move(y2)};</span>
<span id="cb10-15"><a href="#cb10-15"></a>  <span class="co">// Any assignment is impossible..</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>}</span></code></pre></div>
</div>
</div>
</section>
<section id="whats-the-magic-made-of" class="slide level2">
<h2>What’s the magic made of?</h2>
<blockquote>
<p>For a <strong>default-defined SMF</strong>: the corresponding action (default construct/copy/move) will be performed on the non-<code class="sourceCode cpp"><span class="at">static</span></code> member variables.</p>
</blockquote>
<div class="fragment">
<blockquote>
<p>For a <strong>deleted SMF</strong>: the corresponding SMF is defined but may not be used.</p>
</blockquote>
</div>
<div class="fragment">
<p>There are exceptions.</p>
</div>
</section>
<section id="smf-prototypes" class="slide level2">
<h2>SMF prototypes</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">struct</span> T {</span>
<span id="cb11-2"><a href="#cb11-2"></a>  T();                          <span class="co">// Default constructor.</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  ~T();                         <span class="co">// Destructor.</span></span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a>  T(<span class="at">const</span> T&amp; other);            <span class="co">// Copy constructor.</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  T&amp; <span class="kw">operator</span>=(<span class="at">const</span> T&amp; other); <span class="co">// Copy assignment operator.</span></span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a>  T(T&amp;&amp; other);                 <span class="co">// Move constructor (C++11 and later).</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>  T&amp; <span class="kw">operator</span>=(T&amp;&amp; other);      <span class="co">// Move assignment operator (C++11 and later).</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>};</span></code></pre></div>
<p>Mandatory memory material <img data-src="images/em-m.svg" style="width:3.0%" /></p>
</section>
<section id="special-member-constructors" class="slide level2">
<h2>Special member: constructors</h2>
<p>A constructor is called when initialization of an object takes place.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">struct</span> X { <span class="co">/* ... */</span> };</span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a>X a;               <span class="co">// Calls default constructor.</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>X b{};             <span class="co">// Calls default constructor.</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="kw">auto</span> c = X{};      <span class="co">// Calls default constructor (&#39;copy initialization&#39;).</span></span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a>X d{<span class="dv">42</span>};           <span class="co">// Calls &#39;some&#39; (non-default) constructor taking an int.</span></span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a>X e{a};            <span class="co">// Calls copy constructor.</span></span>
<span id="cb12-10"><a href="#cb12-10"></a></span>
<span id="cb12-11"><a href="#cb12-11"></a>X f{<span class="bu">std::</span>move(a)}; <span class="co">// Calls move constructor.</span></span></code></pre></div>
</section>
<section id="constructor-bingo" class="slide level2">
<h2>Constructor bingo!</h2>
<p><img data-src="images/bingo-chart.png" style="width:45.0%" /></p>
<p><img data-src="images/em-open_mouth.svg" style="width:5.0%" /></p>
</section>
<section id="sorry-no-bingo" class="slide level2">
<h2>Sorry, no bingo</h2>
<ul>
<li class="fragment"><strong>Default</strong> c’tor</li>
<li class="fragment"><strong>Non-default</strong> c’tor(s)</li>
<li class="fragment"><strong>Copy</strong> c’tor</li>
<li class="fragment"><strong>Move</strong> c’tor</li>
</ul>
</section>
<section id="default-constructors" class="slide level2">
<h2>Default constructors</h2>
<blockquote>
<p>Constructors that may be called without any argument are default constructors.</p>
</blockquote>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">struct</span> X { <span class="co">/* ... */</span> };</span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a>X a;</span>
<span id="cb13-4"><a href="#cb13-4"></a>X b();</span>
<span id="cb13-5"><a href="#cb13-5"></a>X c{};</span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="kw">auto</span> d = X{};</span></code></pre></div>
</section>
<section id="non-default-constructors" class="slide level2">
<h2>Non-default constructors</h2>
<p>Any constructor that is not a default constructor.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">struct</span> X { <span class="co">/* ... */</span> };</span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>X a{<span class="dv">42</span>};</span>
<span id="cb14-4"><a href="#cb14-4"></a>X b(<span class="st">&quot;Hi!&quot;</span>, <span class="fl">3.1415</span><span class="bu">f</span>);</span>
<span id="cb14-5"><a href="#cb14-5"></a>X c{a};</span>
<span id="cb14-6"><a href="#cb14-6"></a>X d{<span class="bu">std::</span>move(b)};</span></code></pre></div>
</section>
<section id="special-member-destructors" class="slide level2">
<h2>Special member: destructors</h2>
<blockquote>
<p>The destructor is called when object lifetime ends.</p>
</blockquote>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">struct</span> X { <span class="co">/* ... */</span> };</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>{</span>
<span id="cb15-4"><a href="#cb15-4"></a>  X a;</span>
<span id="cb15-5"><a href="#cb15-5"></a></span>
<span id="cb15-6"><a href="#cb15-6"></a>  {</span>
<span id="cb15-7"><a href="#cb15-7"></a>    X b;</span>
<span id="cb15-8"><a href="#cb15-8"></a>  } <span class="co">// Destructor of &#39;b&#39; is called.</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>}   <span class="co">// Destructor of &#39;a&#39; is called.</span></span></code></pre></div>
</section>
<section id="special-member-copy-ops" class="slide level2">
<h2>Special member: copy ops</h2>
<table style="width:90%;">
<colgroup>
<col style="width: 44%" />
<col style="width: 45%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Copy constructor</td>
<td><code class="sourceCode cpp">T(<span class="at">const</span> T&amp;)</code></td>
</tr>
<tr class="even">
<td>Copy assignment operator</td>
<td><code class="sourceCode cpp">T&amp; <span class="kw">operator</span>=(<span class="at">const</span> T&amp;)</code></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">struct</span> X { <span class="co">/* ... */</span> };</span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>X a;</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a>X b{a};  <span class="co">// Calls copy constructor.</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>X c = a; <span class="co">// Calls copy constructor.</span></span>
<span id="cb16-7"><a href="#cb16-7"></a></span>
<span id="cb16-8"><a href="#cb16-8"></a>b = a;   <span class="co">// Calls copy assignment operator.</span></span></code></pre></div>
</section>
<section id="special-member-move-ops" class="slide level2">
<h2>Special member: move ops</h2>
<table style="width:83%;">
<colgroup>
<col style="width: 44%" />
<col style="width: 38%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Move constructor</td>
<td><code class="sourceCode cpp">T(T&amp;&amp;)</code></td>
</tr>
<tr class="even">
<td>Move assignment operator</td>
<td><code class="sourceCode cpp">T&amp; <span class="kw">operator</span>=(T&amp;&amp;)</code></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">struct</span> X { <span class="co">/* ... */</span> };</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>X a1, a2, a3;</span>
<span id="cb17-4"><a href="#cb17-4"></a></span>
<span id="cb17-5"><a href="#cb17-5"></a>X b{<span class="bu">std::</span>move(a1)};  <span class="co">// Calls move constructor.</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>X c = <span class="bu">std::</span>move(a2); <span class="co">// Calls move constructor.</span></span>
<span id="cb17-7"><a href="#cb17-7"></a></span>
<span id="cb17-8"><a href="#cb17-8"></a>b = <span class="bu">std::</span>move(a3);   <span class="co">// Calls move assignment operator.</span></span></code></pre></div>
</section>
<section id="noisy-type" class="slide level2">
<h2>Noisy type</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="pp">#define LOG </span>puts(<span class="ot">__PRETTY_FUNCTION__</span>)</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="kw">struct</span> T {</span>
<span id="cb18-6"><a href="#cb18-6"></a>  T()                     { LOG; }</span>
<span id="cb18-7"><a href="#cb18-7"></a>  ~T()                    { LOG; }</span>
<span id="cb18-8"><a href="#cb18-8"></a>  T(<span class="at">const</span> T &amp;)            { LOG; }</span>
<span id="cb18-9"><a href="#cb18-9"></a>  T &amp;<span class="kw">operator</span>=(<span class="at">const</span> T &amp;) { LOG; <span class="cf">return</span> *<span class="kw">this</span>; }</span>
<span id="cb18-10"><a href="#cb18-10"></a>  T(T &amp;&amp;)                 { LOG; }</span>
<span id="cb18-11"><a href="#cb18-11"></a>  T &amp;<span class="kw">operator</span>=(T &amp;&amp;)      { LOG; <span class="cf">return</span> *<span class="kw">this</span>; }</span>
<span id="cb18-12"><a href="#cb18-12"></a>};</span></code></pre></div>
</section>
<section id="smfs-and-composition" class="slide level2">
<h2>SMFs and composition</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">struct</span> Member { <span class="co">/* ... */</span> };</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="kw">struct</span> Type { <span class="co">/* ... */</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  Member <span class="va">v_</span>;</span>
<span id="cb19-5"><a href="#cb19-5"></a>};</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="dt">int</span> main() {</span>
<span id="cb19-8"><a href="#cb19-8"></a>  Type t;</span>
<span id="cb19-9"><a href="#cb19-9"></a>}</span></code></pre></div>
</div><div class="column">
<p>Output:</p>
<pre><code>Member::Member()
Type::Type()
Type::~Type()
Member::~Member()</code></pre>
</div>
</div>
</section>
<section id="smfs-and-inheritance" class="slide level2">
<h2>SMFs and inheritance</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">struct</span> Base { <span class="co">/* ... */</span> };</span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="kw">struct</span> Derived : Base { <span class="co">/* ... */</span> };</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="dt">int</span> main() {</span>
<span id="cb21-6"><a href="#cb21-6"></a>  Derived d;</span>
<span id="cb21-7"><a href="#cb21-7"></a>}</span></code></pre></div>
</div><div class="column">
<p>Output:</p>
<pre><code>Base::Base()
Derived::Derived()
Derived::~Derived()
Base::~Base()</code></pre>
</div>
</div>
</section>
<section id="smfs-and-inheritance-1" class="slide level2">
<h2>SMFs and inheritance</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">struct</span> Base { <span class="co">/* ... */</span> };</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">struct</span> Member { <span class="co">/* ... */</span> };</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="kw">struct</span> Derived : Base { <span class="co">/* ... */</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>  Member <span class="va">v_</span>;</span>
<span id="cb23-6"><a href="#cb23-6"></a>};</span>
<span id="cb23-7"><a href="#cb23-7"></a></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="dt">int</span> main() {</span>
<span id="cb23-9"><a href="#cb23-9"></a>  Derived d;</span>
<span id="cb23-10"><a href="#cb23-10"></a>}</span></code></pre></div>
</div><div class="column">
<p>Output:</p>
<pre><code>// ?
// ?
// ?
// ?
// ?
// ?</code></pre>
</div>
</div>
</section>
<section id="smfs-and-inheritance-2" class="slide level2">
<h2>SMFs and inheritance</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">struct</span> Base { <span class="co">/* ... */</span> };</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="kw">struct</span> Member { <span class="co">/* ... */</span> };</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="kw">struct</span> Derived : Base { <span class="co">/* ... */</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>  Member <span class="va">v_</span>;</span>
<span id="cb25-6"><a href="#cb25-6"></a>};</span>
<span id="cb25-7"><a href="#cb25-7"></a></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="dt">int</span> main() {</span>
<span id="cb25-9"><a href="#cb25-9"></a>  Derived d;</span>
<span id="cb25-10"><a href="#cb25-10"></a>}</span></code></pre></div>
</div><div class="column">
<p>Output:</p>
<pre><code>// ?
// ?
Derived::Derived()
Derived::~Derived()
// ?
// ?</code></pre>
</div>
</div>
</section>
<section id="smfs-and-inheritance-3" class="slide level2">
<h2>SMFs and inheritance</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">struct</span> Base { <span class="co">/* ... */</span> };</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="kw">struct</span> Member { <span class="co">/* ... */</span> };</span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="kw">struct</span> Derived : Base { <span class="co">/* ... */</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  Member <span class="va">v_</span>;</span>
<span id="cb27-6"><a href="#cb27-6"></a>};</span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="dt">int</span> main() {</span>
<span id="cb27-9"><a href="#cb27-9"></a>  Derived d;</span>
<span id="cb27-10"><a href="#cb27-10"></a>}</span></code></pre></div>
</div><div class="column">
<p>Output:</p>
<pre><code>Base::Base()
Member::Member()
Derived::Derived()
Derived::~Derived()
Member::~Member()
Base::~Base()</code></pre>
</div>
</div>
</section>
<section id="smfs-and-inheritance-4" class="slide level2">
<h2>SMFs and inheritance</h2>
<p><img data-src="images/inheritance-order.png" style="width:90.0%" /></p>
<ol type="1">
<li class="fragment">Base class(es),</li>
<li class="fragment">Non-<code class="sourceCode cpp"><span class="at">static</span></code> member variable(s),</li>
<li class="fragment">Derived class.</li>
</ol>
<div class="fragment">
<p>Destruction is order is reverse <img data-src="images/em-arrow_right_hook.svg" style="width:3.0%" /></p>
</div>
</section></section>
<section>
<section id="declaration-rules" class="title-slide slide level1">
<h1>Declaration <span style="color:crimson"><strong>rules</strong></span></h1>

</section>
<section id="when-are-smfs-generated" class="slide level2">
<h2>When are SMFs generated?</h2>
<p><img data-src="images/labyrinth.jpg" style="width:75.0%" /></p>
</section>
<section id="section-1" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-1.png" style="width:70.0%" /></p>
</section>
<section id="section-2" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-2.png" style="width:70.0%" /></p>
</section>
<section id="section-3" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-3.png" style="width:70.0%" /></p>
</section>
<section id="section-4" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-4.png" style="width:70.0%" /></p>
</section>
<section id="section-5" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-5.png" style="width:70.0%" /></p>
</section>
<section id="section-6" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-6.png" style="width:70.0%" /></p>
</section>
<section id="section-7" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-7.png" style="width:70.0%" /></p>
</section>
<section id="section-8" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-7_highlight1.png" style="width:70.0%" /></p>
</section>
<section id="section-9" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-7_highlight2.png" style="width:70.0%" /></p>
</section>
<section id="section-10" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-7_highlight3.png" style="width:70.0%" /></p>
</section>
<section id="declaration-rules-summary" class="slide level2">
<h2>Declaration rules summary</h2>
<p>Compiler-undeclaration rules are easier to remember <img data-src="images/em-x.svg" style="width:3.0%" /><br/><br/></p>
<div class="fragment">
<table style="width:79%;">
<colgroup>
<col style="width: 43%" />
<col style="width: 36%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>When user declares..</strong></td>
<td><strong>Undeclaration of..</strong></td>
</tr>
<tr class="even">
<td>Any other constructor</td>
<td>Default constructor</td>
</tr>
<tr class="odd">
<td>Any move operation</td>
<td>Copy operations</td>
</tr>
<tr class="even">
<td>Any copy/move/destructor</td>
<td>Move operations</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="declaration-rules-summary-1" class="slide level2">
<h2>Declaration rules summary</h2>
<p>Compiler-undeclaration rules easier to remember <img data-src="images/em-x.svg" style="width:3.0%" /><br/><br/></p>
<table>
<colgroup>
<col style="width: 66%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>When user declares..</strong></td>
<td><strong>Undeclaration of..</strong></td>
</tr>
<tr class="even">
<td><code class="sourceCode cpp">T(*)</code></td>
<td><code class="sourceCode cpp">T()</code></td>
</tr>
<tr class="odd">
<td><code class="sourceCode cpp">*(T&amp;&amp;)</code></td>
<td><code class="sourceCode cpp">*(<span class="at">const</span> T&amp;)</code></td>
</tr>
<tr class="even">
<td><code class="sourceCode cpp">*(<span class="at">const</span> T&amp;)</code>/<code class="sourceCode cpp">*(T&amp;&amp;)</code>/<code class="sourceCode cpp">~T()</code></td>
<td><code class="sourceCode cpp">*(T&amp;&amp;)</code></td>
</tr>
</tbody>
</table>
</section>
<section id="copy-vs-move-and-fallback" class="slide level2">
<h2>Copy vs move and fallback</h2>
<p>Consider this copy-only class:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">class</span> X { <span class="co">/* Move operations deleted, copy operations implemented. */</span> };</span>
<span id="cb29-2"><a href="#cb29-2"></a></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="dt">int</span> main() {</span>
<span id="cb29-4"><a href="#cb29-4"></a>  X x;</span>
<span id="cb29-5"><a href="#cb29-5"></a>  X y{x};            <span class="co">// Will copy-construct.</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>  X z{<span class="bu">std::</span>move(x)}; <span class="co">// Will copy-construct.</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>}</span></code></pre></div>
<p><img data-src="images/em-thinking_face.svg" style="width:6.0%" /></p>
</section>
<section id="section-11" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-7.png" style="width:70.0%" /></p>
</section>
<section id="section-12" class="slide level2">
<h2></h2>
<p><img data-src="images/special-member-functions-table-8.png" style="width:70.0%" /></p>
</section>
<section id="porting-legacy-code" class="slide level2">
<h2>Porting legacy code</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">class</span> X { <span class="co">// Implementation Somewhere Else (tm).</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw">public</span>:</span>
<span id="cb30-3"><a href="#cb30-3"></a>  X();</span>
<span id="cb30-4"><a href="#cb30-4"></a>  ~X();</span>
<span id="cb30-5"><a href="#cb30-5"></a></span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="co">// ...</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>};</span>
<span id="cb30-8"><a href="#cb30-8"></a></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="bu">std::</span>vector&lt;X&gt; v;</span>
<span id="cb30-10"><a href="#cb30-10"></a></span>
<span id="cb30-11"><a href="#cb30-11"></a>v.push_back(X()); <span class="co">// Pre-C++11      : copy</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>                  <span class="co">// C++11 and later: ????</span></span></code></pre></div>
</div><div class="column" style="width:40%;">
<p><br/> <img data-src="images/vector_push_back.png" style="width:100.0%" /></p>
</div>
</div>
<div class="fragment">
<p>C++11 and later will still copy – due to <code class="sourceCode cpp">~X()</code> and copy fallback</p>
</div>
</section>
<section id="porting-legacy-code-1" class="slide level2">
<h2>Porting legacy code</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">class</span> X { <span class="co">// Implementation Somewhere Else (tm).</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">public</span>:</span>
<span id="cb31-3"><a href="#cb31-3"></a>  X();</span>
<span id="cb31-4"><a href="#cb31-4"></a>  ~X();</span>
<span id="cb31-5"><a href="#cb31-5"></a></span>
<span id="cb31-6"><a href="#cb31-6"></a>  X(X&amp;&amp; other);</span>
<span id="cb31-7"><a href="#cb31-7"></a>  X&amp; <span class="kw">operator</span>=(X&amp;&amp; other);</span>
<span id="cb31-8"><a href="#cb31-8"></a></span>
<span id="cb31-9"><a href="#cb31-9"></a>  <span class="co">// ...</span></span>
<span id="cb31-10"><a href="#cb31-10"></a>};</span>
<span id="cb31-11"><a href="#cb31-11"></a></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="bu">std::</span>vector&lt;X&gt; v;</span>
<span id="cb31-13"><a href="#cb31-13"></a></span>
<span id="cb31-14"><a href="#cb31-14"></a>v.push_back(X()); <span class="co">// Pre-C++11      : copy</span></span>
<span id="cb31-15"><a href="#cb31-15"></a>                  <span class="co">// C++11 and later: move</span></span></code></pre></div>
</div><div class="column" style="width:40%;">
<p><br/> <img data-src="images/vector_push_back.png" style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="rule-of-x" class="slide level2">
<h2>Rule of …X?</h2>
<div class="columns">
<div class="column">
<table style="width:72%;">
<colgroup>
<col style="width: 72%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Rule of zero</td>
</tr>
<tr class="even">
<td>Rule of zero or all</td>
</tr>
<tr class="odd">
<td>Rule of three</td>
</tr>
<tr class="even">
<td>Rule of four and a half</td>
</tr>
</tbody>
</table>
</div><div class="column">
<table style="width:39%;">
<colgroup>
<col style="width: 38%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Rule of five</td>
</tr>
<tr class="even">
<td>Rule of six</td>
</tr>
<tr class="odd">
<td>Copy-only</td>
</tr>
<tr class="even">
<td>Move-only</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><img data-src="images/em-exploding_head.svg" style="width:6.0%" /></p>
</section>
<section id="rule-of-zero" class="slide level2">
<h2>Rule of zero</h2>
<blockquote>
<p>If you don’t have to implement SMFs…then don’t!</p>
</blockquote>
<div class="sourceCode" id="cb32"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a><span class="kw">struct</span> X {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a>  <span class="co">// Let the compiler do all the work.</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a>};</span></code></pre></div>
</section>
<section id="if-custom-smfs-are-needed" class="slide level2">
<h2>If custom SMFs are needed</h2>
<ul>
<li class="fragment">Container classes,</li>
<li class="fragment">Resource managing classes,</li>
<li class="fragment">Immobile classes.</li>
</ul>
<div class="fragment">
<p>Use the rule of zero for everything else.</p>
</div>
</section>
<section id="container-classes" class="slide level2">
<h2>Container classes</h2>
<p>Implement all SMFs, or: ‘rule of six’:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">struct</span> Container {</span>
<span id="cb33-2"><a href="#cb33-2"></a>  Container();</span>
<span id="cb33-3"><a href="#cb33-3"></a>  ~Container();</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a>  Container(<span class="at">const</span> Container&amp; other);</span>
<span id="cb33-6"><a href="#cb33-6"></a>  Container&amp; <span class="kw">operator</span>=(<span class="at">const</span> Container&amp; other);</span>
<span id="cb33-7"><a href="#cb33-7"></a></span>
<span id="cb33-8"><a href="#cb33-8"></a>  Container(Container&amp;&amp; other);</span>
<span id="cb33-9"><a href="#cb33-9"></a>  Container&amp; <span class="kw">operator</span>=(Container&amp;&amp; other);</span>
<span id="cb33-10"><a href="#cb33-10"></a>};</span></code></pre></div>
</section>
<section id="resource-managing-classes" class="slide level2">
<h2>Resource managing classes</h2>
<p>Implement as move-only / uncopyable:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1"></a><span class="kw">struct</span> ResourceManager {</span>
<span id="cb34-2"><a href="#cb34-2"></a>  ResourceManager();</span>
<span id="cb34-3"><a href="#cb34-3"></a>  ~ResourceManager();</span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a>  ResourceManager(ResourceManager&amp;&amp; other);</span>
<span id="cb34-6"><a href="#cb34-6"></a>  ResourceManager&amp; <span class="kw">operator</span>=(ResourceManager&amp;&amp; other);</span>
<span id="cb34-7"><a href="#cb34-7"></a>};</span></code></pre></div>
<p>The rules/compiler will take care of the rest.</p>
</section>
<section id="immobile-classes" class="slide level2">
<h2>Immobile classes <img data-src="images/em-house.svg" style="width:5.0%" /></h2>
<p>Implement as non-copyable, non-movable:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">struct</span> Immobile {</span>
<span id="cb35-2"><a href="#cb35-2"></a>  Immobile(<span class="at">const</span> Immobile&amp; other) = <span class="kw">delete</span>;</span>
<span id="cb35-3"><a href="#cb35-3"></a>  Immobile&amp; <span class="kw">operator</span>=(<span class="at">const</span> Immobile&amp; other) = <span class="kw">delete</span>;</span>
<span id="cb35-4"><a href="#cb35-4"></a>};</span></code></pre></div>
<p>The rules/compiler will take care of the rest.</p>
</section>
<section id="the-rule-of-zero-or-all" class="slide level2">
<h2>The rule of zero or all</h2>
<blockquote>
<p>As a general one-rule-only policy the rule of zero or all can be followed.</p>
</blockquote>
<div class="fragment">
<p>Trigger for ‘all’ is any copy/move operations or <code class="sourceCode cpp">~T()</code></p>
</div>
</section>
<section id="some-last-notes" class="slide level2">
<h2>Some last notes <img data-src="images/em-point_up.svg" style="width:7.0%" /></h2>
<ul>
<li class="fragment">Try to have a default constructor,</li>
<li class="fragment">Don’t split copy operations and move operations,</li>
<li class="fragment">Don’t build copy-only types, they are surprising.</li>
</ul>
</section></section>
<section>
<section id="implementation-guidelines" class="title-slide slide level1">
<h1>Implementation <span style="color:crimson"><strong>guidelines</strong></span></h1>

</section>
<section id="what-are-the-options" class="slide level2">
<h2>What are the options?</h2>
<ol type="1">
<li class="fragment">Do nothing,</li>
<li class="fragment">Provide a custom implementation,</li>
<li class="fragment">Provide a default implementation,</li>
<li class="fragment">‘Hide’ an SMF.</li>
</ol>
</section>
<section id="defaulting-or-hiding-an-smf" class="slide level2">
<h2>Defaulting or hiding an SMF <img data-src="images/cpp-classic.png" style="width:8.0%" /></h2>
<ul>
<li class="fragment">Default implementation: <code class="sourceCode cpp">T(){}</code></li>
<li class="fragment">‘Hiding’ an SMF: declaration in <code class="sourceCode cpp"><span class="kw">private</span></code> section</li>
</ul>
</section>
<section id="defaulting-or-hiding-an-smf-1" class="slide level2">
<h2>Defaulting or hiding an SMF <img data-src="images/cpp-modern.png" style="width:8.0%" /></h2>
<ul>
<li class="fragment">Default implementation: <code class="sourceCode cpp">T() = <span class="cf">default</span>;</code></li>
<li class="fragment">‘Hiding’ an SMF: <code class="sourceCode cpp">T() = <span class="kw">delete</span>;</code> in <code class="sourceCode cpp"><span class="kw">public</span></code> section</li>
</ul>
</section>
<section id="constructor-guidelines" class="slide level2">
<h2>Constructor guidelines</h2>
<h3 id="general-wisdom">General wisdom <img data-src="images/em-point_up.svg" style="width:6.0%" /></h3>
<ul>
<li class="fragment">Use the member initialization list,</li>
<li class="fragment">Never call <code class="sourceCode cpp"><span class="kw">virtual</span></code> functions from <code class="sourceCode cpp">T()</code>/<code class="sourceCode cpp">~T()</code>,</li>
<li class="fragment">Make sure your object is in a specified state after <code class="sourceCode cpp">T()</code>,</li>
<li class="fragment">Mark a constructor taking only one argument <code class="sourceCode cpp"><span class="kw">explicit</span></code>.</li>
</ul>
</section>
<section id="explicit-constructor" class="slide level2">
<h2>Explicit constructor</h2>
<blockquote>
<p>Make any constructor that takes only one argument an <code class="sourceCode cpp"><span class="kw">explicit</span></code> constructor.</p>
</blockquote>
<p>Unless you intend to write a converting constructor.</p>
</section>
<section id="explicit-constructor-1" class="slide level2">
<h2>Explicit constructor</h2>
<p>Example <img data-src="images/em-hammer_and_wrench.svg" style="width:4.0%" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">struct</span> X {</span>
<span id="cb36-2"><a href="#cb36-2"></a>  X(<span class="dt">int</span> value) {} <span class="co">// Converting constructor.</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>};</span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="dt">void</span> func(X arg) {</span>
<span id="cb36-6"><a href="#cb36-6"></a>}</span>
<span id="cb36-7"><a href="#cb36-7"></a></span>
<span id="cb36-8"><a href="#cb36-8"></a>func(<span class="dv">42</span>); <span class="co">// Will implicitly convert &#39;42&#39; to X..</span></span></code></pre></div>
</section>
<section id="explicit-constructor-2" class="slide level2">
<h2>Explicit constructor</h2>
<p>Example <img data-src="images/em-hammer_and_wrench.svg" style="width:4.0%" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">struct</span> X {</span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="kw">explicit</span> X(<span class="dt">int</span> value) {} <span class="co">// Explicit constructor.</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>};</span>
<span id="cb37-4"><a href="#cb37-4"></a></span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="dt">void</span> func(X arg) {</span>
<span id="cb37-6"><a href="#cb37-6"></a>}</span>
<span id="cb37-7"><a href="#cb37-7"></a></span>
<span id="cb37-8"><a href="#cb37-8"></a>func(<span class="dv">42</span>); <span class="co">// Compiler error!</span></span></code></pre></div>
</section>
<section id="explicit-constructor-3" class="slide level2">
<h2>Explicit constructor</h2>
<p>Example <img data-src="images/em-hammer_and_wrench.svg" style="width:4.0%" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">struct</span> X {</span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="kw">explicit</span> X(<span class="dt">int</span> value) {} <span class="co">// Explicit constructor.</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>};</span>
<span id="cb38-4"><a href="#cb38-4"></a></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="dt">void</span> func(X arg) {</span>
<span id="cb38-6"><a href="#cb38-6"></a>}</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a>func(X{<span class="dv">42</span>}); <span class="co">// OK, explicit and safe.</span></span></code></pre></div>
</section>
<section id="member-initializer-list" class="slide level2">
<h2>Member initializer list</h2>
<p>Consider this example:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw">struct</span> X {</span>
<span id="cb39-2"><a href="#cb39-2"></a>  X(<span class="at">const</span> <span class="bu">std::</span>string &amp;value) {</span>
<span id="cb39-3"><a href="#cb39-3"></a>    <span class="va">value_</span> = value;</span>
<span id="cb39-4"><a href="#cb39-4"></a>  }</span>
<span id="cb39-5"><a href="#cb39-5"></a></span>
<span id="cb39-6"><a href="#cb39-6"></a>  <span class="bu">std::</span>string <span class="va">value_</span>;</span>
<span id="cb39-7"><a href="#cb39-7"></a>};</span></code></pre></div>
<ol type="1">
<li class="fragment">Default-constructs <code>value_</code> first,</li>
<li class="fragment">Calls assignment operator second.</li>
</ol>
</section>
<section id="member-initializer-list-1" class="slide level2">
<h2>Member initializer list</h2>
<p>More efficient version:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">struct</span> X {</span>
<span id="cb40-2"><a href="#cb40-2"></a>  X(<span class="at">const</span> <span class="bu">std::</span>string &amp;value)</span>
<span id="cb40-3"><a href="#cb40-3"></a>    : <span class="va">value_</span>{value} {</span>
<span id="cb40-4"><a href="#cb40-4"></a>  }</span>
<span id="cb40-5"><a href="#cb40-5"></a></span>
<span id="cb40-6"><a href="#cb40-6"></a>  <span class="bu">std::</span>string <span class="va">value_</span>;</span>
<span id="cb40-7"><a href="#cb40-7"></a>};</span></code></pre></div>
<div class="fragment">
<p>Direct-initializes <code>value_</code>.</p>
</div>
</section>
<section id="member-variable-initializations" class="slide level2">
<h2>Member variable initializations</h2>
<p>What about this example? <img data-src="images/cpp-modern.png" style="width:6.0%" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb41-1"><a href="#cb41-1"></a><span class="kw">struct</span> X {</span>
<span id="cb41-2"><a href="#cb41-2"></a>  X()</span>
<span id="cb41-3"><a href="#cb41-3"></a>    : <span class="va">value_</span>{<span class="dv">0</span>} {}</span>
<span id="cb41-4"><a href="#cb41-4"></a></span>
<span id="cb41-5"><a href="#cb41-5"></a>  <span class="dt">int</span> <span class="va">value_</span> = <span class="dv">0</span>;</span>
<span id="cb41-6"><a href="#cb41-6"></a>};</span>
<span id="cb41-7"><a href="#cb41-7"></a></span>
<span id="cb41-8"><a href="#cb41-8"></a>X x;</span></code></pre></div>
<p><strong>Question</strong>: will <code>value_</code> be initialized twice?</p>
<div class="fragment">
<p>No.</p>
</div>
</section>
<section id="member-variable-initializations-1" class="slide level2">
<h2>Member variable initializations</h2>
<p>No constructor needed <img data-src="images/cpp-modern.png" style="width:6.0%" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">struct</span> X {</span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="dt">int</span> <span class="va">value_</span> = <span class="dv">0</span>; <span class="co">// Default member initializer will be used in generated c&#39;tors.</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>};</span>
<span id="cb42-4"><a href="#cb42-4"></a></span>
<span id="cb42-5"><a href="#cb42-5"></a>X x;</span></code></pre></div>
</section>
<section id="member-initializer-list-2" class="slide level2">
<h2>Member initializer list</h2>
<p>Strict initialization order is NOT enforced.. <img data-src="images/em-disappointed.svg" style="width:4.0%" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">struct</span> X {</span>
<span id="cb43-2"><a href="#cb43-2"></a>  X(<span class="dt">int</span> value1, <span class="dt">int</span> value2)</span>
<span id="cb43-3"><a href="#cb43-3"></a>    : <span class="va">value2_</span>{value2 + <span class="va">value1_</span>},</span>
<span id="cb43-4"><a href="#cb43-4"></a>      <span class="va">value1_</span>{value1} {</span>
<span id="cb43-5"><a href="#cb43-5"></a>  }</span>
<span id="cb43-6"><a href="#cb43-6"></a></span>
<span id="cb43-7"><a href="#cb43-7"></a>  <span class="dt">int</span> <span class="va">value1_</span> = {};</span>
<span id="cb43-8"><a href="#cb43-8"></a>  <span class="dt">int</span> <span class="va">value2_</span> = {};</span>
<span id="cb43-9"><a href="#cb43-9"></a>};</span></code></pre></div>
</section>
<section id="member-initializer-list-3" class="slide level2">
<h2>Member initializer list</h2>
<blockquote>
<p>Use the member initializer list!</p>
</blockquote>
<blockquote>
<p>Turn on compiler warnings: <code>-Wreorder</code> / <code>/w15038</code></p>
</blockquote>
<div class="fragment">
<p>(and look at them..or better even, use <code>-Werror</code>/<code>/WX</code>)</p>
</div>
</section>
<section id="destructor-guidelines" class="slide level2">
<h2>Destructor guidelines</h2>
<h3 id="general-wisdom-1">General wisdom <img data-src="images/em-point_up.svg" style="width:6.0%" /></h3>
<ul>
<li class="fragment">Never call <code class="sourceCode cpp"><span class="kw">virtual</span></code> functions from <code class="sourceCode cpp">T()</code>/<code class="sourceCode cpp">~T()</code>,</li>
<li class="fragment">Make destructor <code class="sourceCode cpp"><span class="kw">virtual</span></code> if applicable,</li>
<li class="fragment">Don’t let exceptions leave destructors.</li>
</ul>
</section>
<section id="virtual-destructors" class="slide level2">
<h2><code class="sourceCode cpp"><span class="kw">virtual</span></code> destructors</h2>
<blockquote>
<p>A base class must have a <code class="sourceCode cpp"><span class="kw">virtual</span></code> destructor.</p>
</blockquote>
<div class="sourceCode" id="cb44"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1"></a><span class="kw">struct</span> Base { <span class="co">/* ... */</span> };</span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="kw">struct</span> Derived : Base { <span class="co">/* ... */</span> };</span>
<span id="cb44-3"><a href="#cb44-3"></a></span>
<span id="cb44-4"><a href="#cb44-4"></a>{</span>
<span id="cb44-5"><a href="#cb44-5"></a>  <span class="kw">auto</span> ptr = <span class="bu">std::</span>make_unique&lt;Base&gt;(Derived{});</span>
<span id="cb44-6"><a href="#cb44-6"></a>} <span class="co">// Pointer &#39;ptr&#39; will go out of scope here and destruct via Base-type.</span></span></code></pre></div>
</section>
<section id="virtual-destructors-1" class="slide level2">
<h2><code class="sourceCode cpp"><span class="kw">virtual</span></code> destructors</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw">struct</span> Base {</span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="kw">virtual</span> ~Base();</span>
<span id="cb45-3"><a href="#cb45-3"></a>};</span>
<span id="cb45-4"><a href="#cb45-4"></a></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="kw">struct</span> Derived : Base {</span>
<span id="cb45-6"><a href="#cb45-6"></a>  ~Derived() <span class="kw">override</span>; <span class="co">// &#39;override&#39; specifier was added in C++11.</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>};</span>
<span id="cb45-8"><a href="#cb45-8"></a></span>
<span id="cb45-9"><a href="#cb45-9"></a>{</span>
<span id="cb45-10"><a href="#cb45-10"></a>  <span class="kw">auto</span> ptr = <span class="bu">std::</span>make_unique&lt;Base&gt;(Derived{});</span>
<span id="cb45-11"><a href="#cb45-11"></a>} <span class="co">// All is safe now.</span></span></code></pre></div>
</section>
<section id="destructors-and-exceptions" class="slide level2">
<h2>Destructors and exceptions</h2>
<blockquote>
<p>Don’t throw exceptions from destructors!</p>
</blockquote>
<p> </p>
<p><img data-src="images/em-robot_face.svg" style="width:4.0%" /> <code>terminate()</code> will be called!</p>
</section>
<section id="copy-operations" class="slide level2">
<h2>Copy operations</h2>
<h3 id="general-wisdom-2">General wisdom <img data-src="images/em-point_up.svg" style="width:6.0%" /></h3>
<ul>
<li class="fragment">Always copy all parts of a class,</li>
<li class="fragment">If applicable and needed, call the base class,</li>
<li class="fragment">Handle self-assignment,</li>
<li class="fragment">Return a reference to <code class="sourceCode cpp">*<span class="kw">this</span></code>,</li>
<li class="fragment">Provide (strong) exception-safety.</li>
</ul>
</section>
<section id="move-operations" class="slide level2">
<h2>Move operations</h2>
<h3 id="general-wisdom-3">General wisdom <img data-src="images/em-point_up.svg" style="width:6.0%" /></h3>
<ul>
<li class="fragment">Always move all parts of a class,</li>
<li class="fragment">If applicable and needed, call the base class,</li>
<li class="fragment">Handle self-assignment,</li>
<li class="fragment">Return a reference to <code class="sourceCode cpp">*<span class="kw">this</span></code>,</li>
<li class="fragment">Provide (strong) exception-safety,</li>
<li class="fragment">Leave a moved-from object in a valid state.</li>
</ul>
</section></section>
<section>
<section id="tooling-and-best-practices" class="title-slide slide level1">
<h1>Tooling and <br/><span style="color:crimson"><strong>best practices</strong></span></h1>

</section>
<section id="smfs-in-design-patterns" class="slide level2">
<h2>SMFs in design patterns</h2>
<ul>
<li class="fragment">Singleton</li>
<li class="fragment">Monostate</li>
</ul>
<div class="fragment">
<p>Please don’t use them if you can <img data-src="images/em-point_up.svg" style="width:4.0%" /></p>
</div>
</section>
<section id="raii" class="slide level2">
<h2>RAII</h2>
<blockquote>
<p>RAII == Resource Acquisition Is Initialization</p>
</blockquote>
<p> </p>
<p><code class="sourceCode cpp"><span class="bu">std::</span>unique_ptr&lt;&gt;</code>/<code class="sourceCode cpp"><span class="bu">std::</span>shared_ptr&lt;&gt;</code>/<code class="sourceCode cpp"><span class="bu">std::</span>lock_guard&lt;&gt;</code>/…</p>
</section>
<section id="raii-1" class="slide level2">
<h2>RAII</h2>
<div class="sourceCode" id="cb46"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb46-1"><a href="#cb46-1"></a><span class="dt">void</span> thread_process() {</span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="at">static</span> <span class="bu">std::</span>mutex mutex;</span>
<span id="cb46-3"><a href="#cb46-3"></a></span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="bu">std::</span>lock_guard&lt;<span class="bu">std::</span>mutex&gt; lock(mutex);</span>
<span id="cb46-5"><a href="#cb46-5"></a></span>
<span id="cb46-6"><a href="#cb46-6"></a>  <span class="co">// Do dangerous things that may throw an exception..</span></span>
<span id="cb46-7"><a href="#cb46-7"></a>}</span></code></pre></div>
<div class="fragment">
<p>Object <code class="sourceCode cpp">lock</code> will:</p>
<ul>
<li class="fragment"><code class="sourceCode cpp">lock()</code> the mutex upon construction,</li>
<li class="fragment"><code class="sourceCode cpp">unlock()</code> the mutex upon destruction.</li>
</ul>
</div>
</section>
<section id="the-copy-and-swap-idiom" class="slide level2">
<h2>The copy and swap idiom</h2>
<p>Use this idiom for implementing copy/move operations.</p>
</section>
<section id="copy-and-swap-1" class="slide level2">
<h2>Copy and swap (1)</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb47"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb47-1"><a href="#cb47-1"></a><span class="kw">class</span> X {</span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="kw">public</span>:</span>
<span id="cb47-3"><a href="#cb47-3"></a>  X() { <span class="co">/* ..initialize r_.. */</span> }</span>
<span id="cb47-4"><a href="#cb47-4"></a></span>
<span id="cb47-5"><a href="#cb47-5"></a>  <span class="co">// ???</span></span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a><span class="kw">private</span>:</span>
<span id="cb47-8"><a href="#cb47-8"></a>  Resource <span class="va">r_</span>;</span>
<span id="cb47-9"><a href="#cb47-9"></a>}</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb48"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb48-1"><a href="#cb48-1"></a><span class="dt">int</span> main() {</span>
<span id="cb48-2"><a href="#cb48-2"></a>  X x;</span>
<span id="cb48-3"><a href="#cb48-3"></a>  X y{x};</span>
<span id="cb48-4"><a href="#cb48-4"></a>  y = x;</span>
<span id="cb48-5"><a href="#cb48-5"></a>}</span></code></pre></div>
</div>
</div>
</section>
<section id="copy-and-swap-2" class="slide level2">
<h2>Copy and swap (2)</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb49"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">class</span> X {</span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="kw">public</span>:</span>
<span id="cb49-3"><a href="#cb49-3"></a>  X() { <span class="co">/* ..initialize r_.. */</span> }</span>
<span id="cb49-4"><a href="#cb49-4"></a></span>
<span id="cb49-5"><a href="#cb49-5"></a>  X(<span class="at">const</span> X&amp; other) {</span>
<span id="cb49-6"><a href="#cb49-6"></a>    <span class="va">r_</span> = other.<span class="va">r_</span>;</span>
<span id="cb49-7"><a href="#cb49-7"></a>  }</span>
<span id="cb49-8"><a href="#cb49-8"></a></span>
<span id="cb49-9"><a href="#cb49-9"></a>  <span class="co">// ???</span></span>
<span id="cb49-10"><a href="#cb49-10"></a></span>
<span id="cb49-11"><a href="#cb49-11"></a><span class="kw">private</span>:</span>
<span id="cb49-12"><a href="#cb49-12"></a>  Resource <span class="va">r_</span>;</span>
<span id="cb49-13"><a href="#cb49-13"></a>}</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb50"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb50-1"><a href="#cb50-1"></a><span class="dt">int</span> main() {</span>
<span id="cb50-2"><a href="#cb50-2"></a>  X x;</span>
<span id="cb50-3"><a href="#cb50-3"></a>  X y{x};</span>
<span id="cb50-4"><a href="#cb50-4"></a>  y = x;</span>
<span id="cb50-5"><a href="#cb50-5"></a>}</span></code></pre></div>
</div>
</div>
</section>
<section id="copy-and-swap-3" class="slide level2">
<h2>Copy and swap (3)</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb51"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb51-1"><a href="#cb51-1"></a><span class="kw">class</span> X {</span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="kw">public</span>:</span>
<span id="cb51-3"><a href="#cb51-3"></a>  X() { <span class="co">/* ..initialize resource.. */</span> }</span>
<span id="cb51-4"><a href="#cb51-4"></a></span>
<span id="cb51-5"><a href="#cb51-5"></a>  X(<span class="at">const</span> X&amp; other) { <span class="co">/* ... */</span> }</span>
<span id="cb51-6"><a href="#cb51-6"></a></span>
<span id="cb51-7"><a href="#cb51-7"></a>  X&amp; <span class="kw">operator</span>=(X other) {</span>
<span id="cb51-8"><a href="#cb51-8"></a>    swap(*<span class="kw">this</span>, other);</span>
<span id="cb51-9"><a href="#cb51-9"></a>    <span class="cf">return</span> *<span class="kw">this</span>;</span>
<span id="cb51-10"><a href="#cb51-10"></a>  }</span>
<span id="cb51-11"><a href="#cb51-11"></a></span>
<span id="cb51-12"><a href="#cb51-12"></a>  <span class="kw">friend</span> <span class="dt">void</span> swap(X&amp; x1, X&amp; x2);</span>
<span id="cb51-13"><a href="#cb51-13"></a></span>
<span id="cb51-14"><a href="#cb51-14"></a><span class="kw">private</span>:</span>
<span id="cb51-15"><a href="#cb51-15"></a>  Resource <span class="va">r_</span>;</span>
<span id="cb51-16"><a href="#cb51-16"></a>};</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb52" data-startFrom="17"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 16;"><span id="cb52-17"><a href="#cb52-17"></a><span class="dt">void</span> X::swap(X&amp; x1, X&amp; x2) {</span>
<span id="cb52-18"><a href="#cb52-18"></a>  <span class="bu">std::</span>swap(x1.<span class="va">r_</span>, x2.<span class="va">r_</span>);</span>
<span id="cb52-19"><a href="#cb52-19"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb53-1"><a href="#cb53-1"></a><span class="dt">int</span> main() {</span>
<span id="cb53-2"><a href="#cb53-2"></a>  X x;</span>
<span id="cb53-3"><a href="#cb53-3"></a>  X y{x};</span>
<span id="cb53-4"><a href="#cb53-4"></a>  y = x;</span>
<span id="cb53-5"><a href="#cb53-5"></a>}</span></code></pre></div>
</div>
</div>
</section>
<section id="copy-and-swap-4" class="slide level2">
<h2>Copy and swap (4)</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb54"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb54-1"><a href="#cb54-1"></a><span class="kw">class</span> X {</span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="kw">public</span>:</span>
<span id="cb54-3"><a href="#cb54-3"></a>  X() { <span class="co">/* ..initialize resource.. */</span> }</span>
<span id="cb54-4"><a href="#cb54-4"></a></span>
<span id="cb54-5"><a href="#cb54-5"></a>  X(<span class="at">const</span> X&amp; other)     { <span class="co">/* ... */</span> }</span>
<span id="cb54-6"><a href="#cb54-6"></a>  X&amp; <span class="kw">operator</span>=(X other) { <span class="co">/* ... */</span> }</span>
<span id="cb54-7"><a href="#cb54-7"></a></span>
<span id="cb54-8"><a href="#cb54-8"></a>  X(X&amp;&amp; other)</span>
<span id="cb54-9"><a href="#cb54-9"></a>    : X() {</span>
<span id="cb54-10"><a href="#cb54-10"></a>    swap(*<span class="kw">this</span>, other);</span>
<span id="cb54-11"><a href="#cb54-11"></a>  }</span>
<span id="cb54-12"><a href="#cb54-12"></a></span>
<span id="cb54-13"><a href="#cb54-13"></a>  <span class="kw">friend</span> <span class="dt">void</span> swap(X&amp; x1, X&amp; x2);</span>
<span id="cb54-14"><a href="#cb54-14"></a></span>
<span id="cb54-15"><a href="#cb54-15"></a><span class="kw">private</span>:</span>
<span id="cb54-16"><a href="#cb54-16"></a>  Resource <span class="va">r_</span>;</span>
<span id="cb54-17"><a href="#cb54-17"></a>};</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb55" data-startFrom="18"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp" style="counter-reset: source-line 17;"><span id="cb55-18"><a href="#cb55-18"></a><span class="dt">void</span> X::swap(X&amp; x1, X&amp; x2) {</span>
<span id="cb55-19"><a href="#cb55-19"></a>  <span class="bu">std::</span>swap(x1.<span class="va">r_</span>, x2.<span class="va">r_</span>);</span>
<span id="cb55-20"><a href="#cb55-20"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb56-1"><a href="#cb56-1"></a><span class="dt">int</span> main() {</span>
<span id="cb56-2"><a href="#cb56-2"></a>  X x;</span>
<span id="cb56-3"><a href="#cb56-3"></a>  X y{x};</span>
<span id="cb56-4"><a href="#cb56-4"></a>  y = x;</span>
<span id="cb56-5"><a href="#cb56-5"></a>  X z{<span class="bu">std::</span>move(y)};</span>
<span id="cb56-6"><a href="#cb56-6"></a>  z = <span class="bu">std::</span>move(x);</span>
<span id="cb56-7"><a href="#cb56-7"></a>}</span></code></pre></div>
</div>
</div>
</section>
<section id="uncopyable-type" class="slide level2">
<h2>Uncopyable type</h2>
<div class="sourceCode" id="cb57"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb57-1"><a href="#cb57-1"></a><span class="kw">class</span> Uncopyable {</span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="kw">protected</span>:</span>
<span id="cb57-3"><a href="#cb57-3"></a>  Uncopyable() = <span class="cf">default</span>;</span>
<span id="cb57-4"><a href="#cb57-4"></a>  ~Uncopyable() = <span class="cf">default</span>;</span>
<span id="cb57-5"><a href="#cb57-5"></a></span>
<span id="cb57-6"><a href="#cb57-6"></a><span class="kw">public</span>:</span>
<span id="cb57-7"><a href="#cb57-7"></a>  Uncopyable(<span class="at">const</span> Uncopyable&amp;) = <span class="kw">delete</span>;</span>
<span id="cb57-8"><a href="#cb57-8"></a>  Uncopyable&amp; <span class="kw">operator</span>=(<span class="at">const</span> Uncopyable&amp;) = <span class="kw">delete</span>;</span>
<span id="cb57-9"><a href="#cb57-9"></a></span>
<span id="cb57-10"><a href="#cb57-10"></a>  Uncopyable(Uncopyable&amp;&amp;) = <span class="cf">default</span>;</span>
<span id="cb57-11"><a href="#cb57-11"></a>  Uncopyable&amp; <span class="kw">operator</span>=(Uncopyable&amp;&amp;) = <span class="cf">default</span>;</span>
<span id="cb57-12"><a href="#cb57-12"></a>};</span></code></pre></div>
</section>
<section id="uncopyable-type-1" class="slide level2">
<h2>Uncopyable type</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb58-1"><a href="#cb58-1"></a><span class="kw">class</span> Uncopyable { <span class="co">/* ... */</span> };</span>
<span id="cb58-2"><a href="#cb58-2"></a></span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="kw">class</span> X : <span class="kw">private</span> Uncopyable {};</span>
<span id="cb58-4"><a href="#cb58-4"></a></span>
<span id="cb58-5"><a href="#cb58-5"></a><span class="dt">int</span> main() {</span>
<span id="cb58-6"><a href="#cb58-6"></a>  X x;</span>
<span id="cb58-7"><a href="#cb58-7"></a><span class="co">//X y{x};            // Will fail to compile.</span></span>
<span id="cb58-8"><a href="#cb58-8"></a>  X z{<span class="bu">std::</span>move(x)}; <span class="co">// Will move-construct.</span></span>
<span id="cb58-9"><a href="#cb58-9"></a>}</span></code></pre></div>
</section>
<section id="unit-test-your-smfs" class="slide level2">
<h2>Unit-test your SMFs!</h2>
<div class="fragment">
<div class="sourceCode" id="cb59"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb59-1"><a href="#cb59-1"></a>X x;               <span class="co">// Test default construction.</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>X x{...};          <span class="co">// Test alternative construction.</span></span>
<span id="cb59-3"><a href="#cb59-3"></a>X y{x};            <span class="co">// Test copy construction.</span></span>
<span id="cb59-4"><a href="#cb59-4"></a>X y{<span class="bu">std::</span>move(x)}; <span class="co">// Test move construction.</span></span>
<span id="cb59-5"><a href="#cb59-5"></a>y = x;             <span class="co">// Test copy assignment.</span></span>
<span id="cb59-6"><a href="#cb59-6"></a>y = <span class="bu">std::</span>move(x);  <span class="co">// Test move assignment.</span></span></code></pre></div>
</div>
<div class="fragment">
<p>Enable compiler sanitizers! E.g. ASAN, UB, ..</p>
</div>
</section>
<section id="static-analyzers-and-smfs" class="slide level2">
<h2>Static analyzers and SMFs</h2>
<p>Some static analyzers I’ve worked with:</p>
<ul>
<li class="fragment">Any compiler <img data-src="images/em-face_palm.svg" style="width:10.0%" /></li>
<li class="fragment">Cppcheck,</li>
<li class="fragment">Clang-tidy,</li>
<li class="fragment">Clang-analyzer,</li>
<li class="fragment">PVS Studio.</li>
</ul>
<div class="fragment">
<p>They all provide rules for checking SMF use</p>
</div>
</section></section>
<section>
<section id="conclusions" class="title-slide slide level1">
<h1>Conclusions</h1>

</section>
<section id="smf-prototypes-1" class="slide level2">
<h2>SMF prototypes</h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode numberSource cpp numberLines"><code class="sourceCode cpp"><span id="cb60-1"><a href="#cb60-1"></a><span class="kw">struct</span> T {</span>
<span id="cb60-2"><a href="#cb60-2"></a>  T();                          <span class="co">// Default constructor.</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>  ~T();                         <span class="co">// Destructor.</span></span>
<span id="cb60-4"><a href="#cb60-4"></a></span>
<span id="cb60-5"><a href="#cb60-5"></a>  T(<span class="at">const</span> T&amp; other);            <span class="co">// Copy constructor.</span></span>
<span id="cb60-6"><a href="#cb60-6"></a>  T&amp; <span class="kw">operator</span>=(<span class="at">const</span> T&amp; other); <span class="co">// Copy assignment operator.</span></span>
<span id="cb60-7"><a href="#cb60-7"></a></span>
<span id="cb60-8"><a href="#cb60-8"></a>  T(T&amp;&amp; other);                 <span class="co">// Move constructor (C++11 and later).</span></span>
<span id="cb60-9"><a href="#cb60-9"></a>  T&amp; <span class="kw">operator</span>=(T&amp;&amp; other);      <span class="co">// Move assignment operator (C++11 and later).</span></span>
<span id="cb60-10"><a href="#cb60-10"></a>};</span></code></pre></div>
</section>
<section id="declaration-rules-1" class="slide level2">
<h2>Declaration rules</h2>
<table>
<colgroup>
<col style="width: 66%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>When user declares..</strong></td>
<td><strong>Undeclaration of..</strong></td>
</tr>
<tr class="even">
<td><code class="sourceCode cpp">T(*)</code></td>
<td><code class="sourceCode cpp">T()</code></td>
</tr>
<tr class="odd">
<td><code class="sourceCode cpp">*(T&amp;&amp;)</code></td>
<td><code class="sourceCode cpp">*(<span class="at">const</span> T&amp;)</code></td>
</tr>
<tr class="even">
<td><code class="sourceCode cpp">*(<span class="at">const</span> T&amp;)</code>/<code class="sourceCode cpp">*(T&amp;&amp;)</code>/<code class="sourceCode cpp">~T()</code></td>
<td><code class="sourceCode cpp">*(T&amp;&amp;)</code></td>
</tr>
</tbody>
</table>
</section>
<section id="guidelines" class="slide level2">
<h2>Guidelines</h2>
<ul>
<li class="fragment"><strong>SMF policies</strong>:
<ul>
<li class="fragment">Rule of zero (if possible),</li>
<li class="fragment">Custom rules for containers/resources/immobiles,</li>
<li class="fragment">Or: rule of zero or all.</li>
</ul></li>
<li class="fragment">Use the <strong>member initialization list</strong>,</li>
<li class="fragment">Make base class destructors <code class="sourceCode cpp"><span class="kw">virtual</span></code>,</li>
<li class="fragment"><strong>Don’t <code class="sourceCode cpp"><span class="cf">throw</span></code> from destructors</strong>,</li>
<li class="fragment">Use <strong>copy and swap</strong> to implement copy/move operations.</li>
</ul>
</section></section>
<section id="end" class="title-slide slide level1">
<h1>End</h1>
<p>Thank you <img data-src="images/em-grinning.svg" style="width:3.0%" /></p>
<p> </p>
<p><img data-src="images/em-left_speech_bubble.svg" style="width:8.0%" /> <img data-src="images/em-question.svg" style="width:7.0%" /></p>
<p><img data-src="images/em-link.svg" style="width:3.0%" /> <a href="https://github.com/krisvanrens/">github.com/krisvanrens</a></p>
</section>
    </div>
  </div>

  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Transition style
        transition: 'fade', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
